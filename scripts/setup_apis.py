#!/usr/bin/env python3
"""
ðŸ”‘ API Setup Wizard
===================
Interactive setup for all API credentials.
Run once to configure everything.

Usage: python3 scripts/setup_apis.py
"""

import os
from pathlib import Path

EMAIL = "billwill.mentor@gmail.com"

BOLD = "\033[1m"
GREEN = "\033[92m"
YELLOW = "\033[93m"
BLUE = "\033[94m"
RESET = "\033[0m"


def print_header(title):
    print(f"\n{BOLD}{BLUE}{'=' * 60}{RESET}")
    print(f"{BOLD}{BLUE}{title}{RESET}")
    print(f"{BOLD}{BLUE}{'=' * 60}{RESET}\n")


def print_step(n, title, url):
    print(f"\n{YELLOW}Step {n}: {title}{RESET}")
    print(f"   ðŸ“ URL: {url}")
    print(f"   ðŸ“§ Email: {EMAIL}")


def setup_gumroad():
    print_header("ðŸ›’ GUMROAD SETUP")
    print(f"""
{GREEN}Gumroad is already set up for billwill.mentor!{RESET}

To get your API token:
1. Go to: https://app.gumroad.com/settings/advanced
2. Scroll to "Application" section
3. Copy "Access Token"
4. Paste below:
""")
    token = input("Gumroad Access Token: ").strip()
    return {"GUMROAD_ACCESS_TOKEN": token} if token else {}


def setup_polar():
    print_header("â„ï¸ POLAR.SH SETUP")
    print_step(1, "Create Polar Account", "https://polar.sh/signup")
    print(f"""
Polar.sh is a modern Gumroad alternative:
1. Sign up with {EMAIL}
2. Go to Settings > Developers > Personal Access Tokens
3. Create token with 'read' scope
""")
    token = input("Polar Access Token (or Enter to skip): ").strip()
    return {"POLAR_ACCESS_TOKEN": token} if token else {}


def setup_twitter():
    print_header("ðŸ¦ TWITTER/X SETUP")
    print_step(1, "Create Twitter Developer Account", "https://developer.twitter.com")
    print(f"""
For auto-posting tweets:
1. Apply for Developer account with {EMAIL}
2. Create a Project and App
3. Generate API Keys + Access Tokens
4. Enable "Read and Write" permissions
""")

    keys = {}
    for key in [
        "TWITTER_API_KEY",
        "TWITTER_API_SECRET",
        "TWITTER_ACCESS_TOKEN",
        "TWITTER_ACCESS_SECRET",
    ]:
        val = input(f"{key}: ").strip()
        if val:
            keys[key] = val
    return keys


def setup_discord():
    print_header("ðŸ’¬ DISCORD WEBHOOK")
    print("""
For notifications:
1. Open your Discord server
2. Edit Channel > Integrations > Webhooks
3. Create Webhook, copy URL
""")
    url = input("Discord Webhook URL (or Enter to skip): ").strip()
    return {"DISCORD_WEBHOOK_URL": url} if url else {}


def save_env(credentials):
    """Save credentials to .env file."""
    env_file = Path(".env")

    # Load existing
    existing = {}
    if env_file.exists():
        for line in env_file.read_text().splitlines():
            if "=" in line and not line.startswith("#"):
                k, v = line.split("=", 1)
                existing[k.strip()] = v.strip()

    # Merge
    existing.update(credentials)

    # Save
    content = "# ðŸ”‘ API Credentials\n# Generated by setup_apis.py\n\n"
    for k, v in existing.items():
        content += f"{k}={v}\n"

    env_file.write_text(content)
    print(f"\n{GREEN}âœ… Saved to .env{RESET}\n")


def main():
    print_header("ðŸ”‘ API SETUP WIZARD")
    print(f"Email: {EMAIL}")
    print("This wizard will help you configure all APIs.\n")

    all_creds = {}

    # Gumroad
    creds = setup_gumroad()
    all_creds.update(creds)

    # Polar
    creds = setup_polar()
    all_creds.update(creds)

    # Discord
    creds = setup_discord()
    all_creds.update(creds)

    # Twitter (optional)
    if input("\nSet up Twitter API? (y/N): ").lower() == "y":
        creds = setup_twitter()
        all_creds.update(creds)

    # Save
    if all_creds:
        save_env(all_creds)

        # Verify
        print_header("ðŸ”Œ VERIFICATION")
        os.system("python3 scripts/api_hub.py status")
    else:
        print(f"\n{YELLOW}No credentials entered.{RESET}\n")


if __name__ == "__main__":
    main()
