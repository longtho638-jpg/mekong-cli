# Codebase Summary
> Updated: January 23, 2026

## Architecture Overview

AgencyOS uses a **Domain-Driven Design (DDD)** approach with modular architecture. All files comply with the **200-line limit** (Antigravity Standard).

### Antigravity Core (`antigravity/core/`)

| Module | Purpose | Structure |
| :--- | :--- | :--- |
| **registry** | Command & MCP Registry | `api.py`, `commands.py`, `discovery.py`, `mcp_catalog.py`, `store.py` |
| **knowledge** | Automated Knowledge Layer | `graph.py`, `manifest_generator.py`, `search_engine.py`, `entity_extractor.py` |
| **mcp_orchestrator** | MCP Lifecycle Manager | `mcp_orchestrator.py` |
| **ab_testing** | A/B Testing Engine | `engine.py`, `analysis.py`, `reporting.py`, `time_utils.py` |
| **agent_orchestrator** | Agent Coordination | `engine.py`, `analytics.py`, `reporting.py` |
| **agent_swarm** | Multi-Agent Systems | `engine.py`, `registry.py`, `task_manager.py`, `shortcuts.py`, `agent.py` |
| **algorithm** | Algorithm Framework | `core.py`, `confidence.py`, `strategies.py` |
| **cashflow_engine** | Cash Flow Management | `engine.py`, `analytics.py`, `dashboard.py`, `persistence.py` |
| **client_magnet** | Lead Generation | `engine.py`, `analytics.py`, `persistence.py`, `scoring.py` |
| **code_guardian** | Code Quality | `guardian.py`, `monitor.py`, `rollback.py`, `scanner.py` |
| **content_factory** | Content Generation | `engine.py`, `ideation.py`, `production.py`, `scheduling.py`, `distribution.py` |
| **ml/models** | ML Models | `base.py`, `classifiers.py`, `regressors.py`, `utils.py`, `config.py` |
| **moat_engine** | Competitive Moat | `engine.py`, `dashboard.py`, `definitions.py`, `persistence.py`, `strategy.py` |
| **money_maker** | Revenue Generation | `engine.py`, `governance.py`, `qualification.py`, `quoting.py` |
| **proposal_generator** | Proposal Creation | `engine.py`, `analytics.py`, `builder.py`, `persistence.py` |
| **revenue/ai** | Revenue AI | `engine.py`, `forecasting.py`, `goals.py`, `reporting.py` |
| **telemetry** | Agent Observability | `telemetry.py`, `pricing.py`, `telemetry_exporters.py` |
| **mixins** | Reusable Behaviors | StatsMixin, PersistenceMixin |
| **patterns** | Shared Patterns | singleton_factory, BasePersistence |
| **types** | Type Definitions | TypedDict, Protocol definitions |
| **rules** | Rule Expansion (v2) | `00-core/`, `01-strategy/`, `02-development/`, `03-operations/` |

### Security & Governance (`backend/core/security/`)

| Module | Purpose |
| :--- | :--- |
| **rbac.py** | Hierarchical Role-Based Access Control enforcement |
| **audit.py** | Immutable, append-only audit logging service |
| **secrets.py** | Advanced secret management abstraction (Doppler/Vault) |
| **sanitizer.py** | Data Diet enforcement and PII redaction |
| **sla.py** | Real-time SLA tracking and compliance monitoring |

### Infrastructure (`antigravity/infrastructure/`)

| Module | Purpose | Structure |
| :--- | :--- | :--- |
| **opentelemetry/tracer** | Tracing | `base.py`, `context.py`, `decorators.py`, `spans.py` |
| **opentelemetry/processors** | Span Processing | `base.py`, `batch.py`, `filtering.py`, `sampling.py` |
| **opentelemetry/exporters** | Data Export | `base.py`, `console.py`, `otlp.py`, `jaeger.py` |
| **scale** | Scaling Infrastructure | `base.py`, `horizontal.py`, `vertical.py`, `metrics.py` |

### CLI Layer (`cli/` and `antigravity/cli/`)

| Module | Purpose |
| :--- | :--- |
| **cli/entrypoint.py** | Main CLI entry point |
| **cli/commands/** | Command modules (dev, mcp, revenue, strategy, utility) |
| **antigravity/cli/app.py** | CLI application factory |
| **antigravity/cli/commands.py** | Command definitions |
| **antigravity/cli/utils.py** | CLI utilities |

### Interfaces

*   **CLI**: Built with **Typer**. Entry: `main.py` -> `cli/entrypoint.py`
*   **Backend**: Built with **FastAPI**. Entry: `backend/main.py`
*   **Documentation (`apps/docs`)**: Built with **Astro**.
    *   **Modular Landing Page**: Decomposed from monolithic `agencyos.astro` into 14 components in `src/components/landing/` (e.g., `Hero`, `PricingSection`, `FeaturesSection`, `BinhPhapRoadmap`).
    *   **Interactive Demos**: Terminal emulator for command showcase.
    *   **Design System**: Tailwind CSS with MD3-inspired tokens.

### Key Workflows

1.  **Revenue Autopilot**: `core.automation.autopilot` - daily revenue/lead checks
2.  **Hybrid Routing**: `core.ai.hybrid_router` - AI model optimization
3.  **Agent Orchestration**: `core.agent_orchestrator` - markdown-defined agents

### Code Quality Metrics

| Metric | Value |
| :--- | :--- |
| Max file lines | 200 |
| Type coverage | High (TypedDict/Protocol) |
| Test coverage | 100% pass rate |

---
*Generated by AgencyOS Refactoring Engine - January 20, 2026*