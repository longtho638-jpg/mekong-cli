name: ðŸ¤– Jules Tech Debt Cleanup

on:
  # Weekly on Monday at 9 AM UTC (4 PM Vietnam)
  schedule:
    - cron: '0 9 * * 1'
  # Manual trigger
  workflow_dispatch:
    inputs:
      task_type:
        description: 'Type of cleanup task'
        required: true
        default: 'tests'
        type: choice
        options:
          - tests
          - lint
          - docs
          - deps
          - security

env:
  # Note: Jules tasks are handled through jules.google.com
  # This workflow just tracks and reports status
  JULES_ENABLED: true

jobs:
  jules-status:
    name: ðŸ¤– Jules Status Check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Check Jules configuration
        run: |
          echo "## ðŸ¤– Jules Tech Debt Status" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Config | Status |" >> $GITHUB_STEP_SUMMARY
          echo "|--------|--------|" >> $GITHUB_STEP_SUMMARY
          echo "| Repository | longtho638-jpg/mekong-cli |" >> $GITHUB_STEP_SUMMARY
          echo "| Schedule | Weekly Monday 4PM VN |" >> $GITHUB_STEP_SUMMARY
          echo "| Task Type | ${{ github.event.inputs.task_type || 'tests' }} |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          # Check for tech debt indicators
          echo "### ðŸ“Š Code Quality Metrics" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          # Count TODO/FIXME
          TODO_COUNT=$(grep -r "TODO\|FIXME\|HACK\|XXX" --include="*.py" --include="*.ts" --include="*.tsx" . 2>/dev/null | wc -l || echo 0)
          echo "| TODOs/FIXMEs | $TODO_COUNT |" >> $GITHUB_STEP_SUMMARY
          
          # Count any types in Python
          ANY_COUNT=$(grep -r ": any\|: Any" --include="*.py" . 2>/dev/null | wc -l || echo 0)
          echo "| Any types | $ANY_COUNT |" >> $GITHUB_STEP_SUMMARY
          
          # Count test files
          TEST_COUNT=$(find . -name "test_*.py" -o -name "*_test.py" 2>/dev/null | wc -l || echo 0)
          echo "| Test files | $TEST_COUNT |" >> $GITHUB_STEP_SUMMARY
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âœ… Jules status check complete" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "> ðŸ”— Manage Jules tasks at: https://jules.google.com" >> $GITHUB_STEP_SUMMARY

      - name: Generate task suggestion
        run: |
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸŽ¯ Suggested Jules Task" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          case "${{ github.event.inputs.task_type || 'tests' }}" in
            tests)
              echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
              echo "Add unit tests for any functions missing tests in antigravity/core/" >> $GITHUB_STEP_SUMMARY
              echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
              ;;
            lint)
              echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
              echo "Fix all TypeScript and Python type errors" >> $GITHUB_STEP_SUMMARY
              echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
              ;;
            docs)
              echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
              echo "Add missing docstrings to all public functions" >> $GITHUB_STEP_SUMMARY
              echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
              ;;
            deps)
              echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
              echo "Update all dependencies to latest stable versions" >> $GITHUB_STEP_SUMMARY
              echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
              ;;
            security)
              echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
              echo "Fix all security vulnerabilities" >> $GITHUB_STEP_SUMMARY
              echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
              ;;
          esac
