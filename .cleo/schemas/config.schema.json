{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://cleo-dev.com/schemas/v1/config.schema.json",
  "schemaVersion": "2.5.0",
  "title": "CLEO Configuration Schema",
  "description": "Configuration for archive policies, validation rules, logging, and session behavior.",
  "type": "object",
  "required": ["version", "_meta"],
  "additionalProperties": false,

  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference for validation."
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Legacy schema version field (deprecated, use _meta.schemaVersion)"
    },
    "_meta": {
      "type": "object",
      "description": "Configuration file metadata.",
      "required": ["schemaVersion"],
      "additionalProperties": false,
      "properties": {
        "schemaVersion": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Schema version for this file (semver). Canonical source for schema version (replaces root version field)."
        }
      }
    },

    "archive": {
      "type": "object",
      "description": "Archive automation settings.",
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable automatic archiving of completed tasks."
        },
        "daysUntilArchive": {
          "type": "integer",
          "minimum": 1,
          "maximum": 365,
          "default": 7,
          "description": "Days after completion before task is eligible for archive."
        },
        "maxCompletedTasks": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "default": 15,
          "description": "Max completed tasks in todo.json before triggering archive."
        },
        "preserveRecentCount": {
          "type": "integer",
          "minimum": 0,
          "maximum": 20,
          "default": 3,
          "description": "Always keep this many recent completed tasks (for context)."
        },
        "archiveOnSessionEnd": {
          "type": "boolean",
          "default": true,
          "description": "Run archive check at session end."
        },
        "autoArchiveOnComplete": {
          "type": "boolean",
          "default": false,
          "description": "Automatically archive completed task if eligible (age >= daysUntilArchive)."
        },
        "exemptLabels": {
          "type": "array",
          "items": {
            "type": "string",
            "minLength": 1
          },
          "default": ["pinned", "keep"],
          "description": "Labels that exempt tasks from automatic archiving. Add these labels to any task/epic you want to protect from auto-archive."
        },
        "labelPolicies": {
          "type": "object",
          "description": "Per-label retention policies overriding defaults.",
          "additionalProperties": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "daysUntilArchive": {
                "type": "integer",
                "minimum": 1,
                "maximum": 365,
                "description": "Days after completion before task with this label is eligible for archive."
              },
              "neverArchive": {
                "type": "boolean",
                "description": "If true, tasks with this label are never automatically archived."
              }
            }
          },
          "default": {}
        },
        "relationshipSafety": {
          "type": "object",
          "description": "Safety settings for archiving tasks with relationships.",
          "additionalProperties": false,
          "properties": {
            "preventOrphanChildren": {
              "type": "boolean",
              "default": true,
              "description": "Don't archive parent tasks with active children."
            },
            "preventBrokenDependencies": {
              "type": "boolean",
              "default": true,
              "description": "Warn before archiving tasks that would break dependency chains."
            },
            "cascadeArchive": {
              "type": "boolean",
              "default": false,
              "description": "Allow cascade archiving of completed children when parent is archived."
            }
          }
        },
        "phaseTriggers": {
          "type": "object",
          "description": "Phase completion triggers for auto-archiving.",
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false,
              "description": "Enable phase-based archive triggers."
            },
            "phases": {
              "type": "array",
              "items": {
                "type": "string",
                "pattern": "^[a-z][a-z0-9-]*$"
              },
              "default": [],
              "description": "Phase slugs that trigger archiving when completed."
            },
            "archivePhaseOnly": {
              "type": "boolean",
              "default": true,
              "description": "Only archive tasks from the completed phase (vs all eligible tasks)."
            }
          }
        },
        "interactive": {
          "type": "object",
          "description": "Interactive prompts and warnings for archive operations.",
          "additionalProperties": false,
          "properties": {
            "confirmBeforeArchive": {
              "type": "boolean",
              "default": false,
              "description": "Prompt for confirmation before archiving tasks."
            },
            "showWarnings": {
              "type": "boolean",
              "default": true,
              "description": "Show warnings about relationships and dependencies before archiving."
            }
          }
        }
      }
    },

    "logging": {
      "type": "object",
      "description": "Change history logging settings.",
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable logging to todo-log.json."
        },
        "retentionDays": {
          "type": "integer",
          "minimum": 1,
          "maximum": 365,
          "default": 30,
          "description": "Days to retain log entries."
        },
        "level": {
          "type": "string",
          "enum": ["minimal", "standard", "verbose"],
          "default": "standard",
          "description": "minimal=status changes, standard=+notes, verbose=+all fields."
        },
        "logSessionEvents": {
          "type": "boolean",
          "default": true,
          "description": "Log session start/end events."
        }
      }
    },

    "validation": {
      "type": "object",
      "description": "Validation and integrity settings.",
      "additionalProperties": false,
      "properties": {
        "strictMode": {
          "type": "boolean",
          "default": false,
          "description": "Treat warnings as errors."
        },
        "checksumEnabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable checksum verification. CRITICAL for anti-hallucination."
        },
        "enforceAcceptance": {
          "type": "boolean",
          "default": true,
          "description": "Require acceptance criteria for high/critical tasks."
        },
        "requireDescription": {
          "type": "boolean",
          "default": false,
          "description": "Require description field for all tasks."
        },
        "maxActiveTasks": {
          "type": "integer",
          "minimum": 1,
          "maximum": 1,
          "default": 1,
          "description": "Maximum active tasks. Default 1. DO NOT CHANGE without good reason."
        },
        "validateDependencies": {
          "type": "boolean",
          "default": true,
          "description": "Check all depends[] references exist and are valid."
        },
        "detectCircularDeps": {
          "type": "boolean",
          "default": true,
          "description": "Detect and block circular dependencies."
        },
        "phaseValidation": {
          "type": "object",
          "description": "Phase validation and enforcement settings.",
          "additionalProperties": false,
          "properties": {
            "enforcePhaseOrder": {
              "type": "boolean",
              "default": false,
              "description": "Warn when activating tasks outside current project phase."
            },
            "phaseAdvanceThreshold": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100,
              "default": 90,
              "description": "Percentage of tasks that must be completed to advance phase."
            },
            "blockOnCriticalTasks": {
              "type": "boolean",
              "default": true,
              "description": "Prevent phase advancement if critical tasks remain incomplete."
            },
            "warnPhaseContext": {
              "type": "boolean",
              "default": true,
              "description": "Show warning when task phase differs from project phase."
            }
          }
        }
      }
    },

    "verification": {
      "type": "object",
      "description": "Verification gates configuration for task quality tracking.",
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable verification gates for task completion. When true, parent auto-complete requires verification.passed = true."
        },
        "maxRounds": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10,
          "default": 5,
          "description": "Maximum implementation rounds before HITL escalation."
        },
        "requiredGates": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["implemented", "testsPassed", "qaPassed", "cleanupDone", "securityPassed", "documented"]
          },
          "default": ["implemented", "testsPassed", "qaPassed", "securityPassed", "documented"],
          "description": "Gates required to pass for verification.passed = true. cleanupDone excluded by default."
        },
        "autoSetImplementedOnComplete": {
          "type": "boolean",
          "default": true,
          "description": "Automatically set gates.implemented = true when ct complete runs."
        },
        "requireForParentAutoComplete": {
          "type": "boolean",
          "default": true,
          "description": "Require verification.passed = true for parent auto-complete."
        },
        "allowManualOverride": {
          "type": "boolean",
          "default": true,
          "description": "Allow --skip-verification flag on ct complete."
        }
      }
    },

    "defaults": {
      "type": "object",
      "description": "Default values for new tasks.",
      "additionalProperties": false,
      "properties": {
        "priority": {
          "type": "string",
          "enum": ["critical", "high", "medium", "low"],
          "default": "medium"
        },
        "phase": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "default": "core"
        },
        "labels": {
          "type": "array",
          "items": { "type": "string" },
          "default": []
        }
      }
    },

    "session": {
      "type": "object",
      "description": "Session behavior settings.",
      "additionalProperties": false,
      "properties": {
        "requireSession": {
          "type": "boolean",
          "default": true,
          "description": "Require an active session for task operations."
        },
        "requireSessionNote": {
          "type": "boolean",
          "default": true,
          "description": "Warn if session ends without updating sessionNote."
        },
        "requireNotesOnComplete": {
          "type": "boolean",
          "default": true,
          "description": "Require notes when completing tasks."
        },
        "warnOnNoFocus": {
          "type": "boolean",
          "default": true,
          "description": "Warn if no task is active at session start."
        },
        "allowNestedSessions": {
          "type": "boolean",
          "default": true,
          "description": "Allow nested session scopes."
        },
        "allowParallelAgents": {
          "type": "boolean",
          "default": true,
          "description": "Allow multiple agents to work concurrently."
        },
        "autoStartSession": {
          "type": "boolean",
          "default": true,
          "description": "Automatically log session_start on first read."
        },
        "autoDiscoveryOnStart": {
          "type": "boolean",
          "default": true,
          "description": "Auto-discover existing sessions on start."
        },
        "sessionTimeoutHours": {
          "type": "integer",
          "minimum": 1,
          "maximum": 72,
          "default": 24,
          "description": "Hours before orphaned session warning."
        }
      }
    },

    "display": {
      "type": "object",
      "description": "Display and notification settings.",
      "additionalProperties": false,
      "properties": {
        "showArchiveCount": {
          "type": "boolean",
          "default": true,
          "description": "Show archived task count in status output."
        },
        "showLogSummary": {
          "type": "boolean",
          "default": true,
          "description": "Show recent log summary."
        },
        "warnStaleDays": {
          "type": "integer",
          "minimum": 1,
          "default": 30,
          "description": "Warn about tasks pending longer than this."
        }
      }
    },

    "output": {
      "type": "object",
      "description": "Output formatting and display preferences.",
      "additionalProperties": false,
      "properties": {
        "defaultFormat": {
          "type": "string",
          "enum": ["text", "json", "jsonl", "csv", "tsv", "markdown", "table"],
          "default": "text",
          "description": "Default output format for list and export commands."
        },
        "showColor": {
          "type": "boolean",
          "default": true,
          "description": "Enable ANSI color output. Respects NO_COLOR env var."
        },
        "showUnicode": {
          "type": "boolean",
          "default": true,
          "description": "Use Unicode symbols and box-drawing characters."
        },
        "showProgressBars": {
          "type": "boolean",
          "default": true,
          "description": "Show progress bars in dashboard and phase views."
        },
        "csvDelimiter": {
          "type": "string",
          "maxLength": 1,
          "default": ",",
          "description": "Delimiter for CSV export (comma, tab, semicolon)."
        },
        "dateFormat": {
          "type": "string",
          "enum": ["iso8601", "relative", "unix", "locale"],
          "default": "iso8601",
          "description": "Date/time display format: iso8601, relative (5min ago), unix, locale."
        },
        "showCompactTitles": {
          "type": "boolean",
          "default": false,
          "description": "Truncate long task titles in list view."
        },
        "maxTitleLength": {
          "type": "integer",
          "minimum": 20,
          "maximum": 200,
          "default": 80,
          "description": "Maximum title length when showCompactTitles is enabled."
        }
      }
    },

    "cli": {
      "type": "object",
      "description": "CLI behavior, aliases, and plugin settings.",
      "additionalProperties": false,
      "properties": {
        "aliases": {
          "type": "object",
          "description": "Command aliases mapping short names to commands.",
          "additionalProperties": {
            "type": "string",
            "description": "Target command name."
          },
          "default": {
            "ls": "list",
            "done": "complete",
            "new": "add",
            "edit": "update",
            "rm": "archive",
            "check": "validate"
          }
        },
        "plugins": {
          "type": "object",
          "description": "Plugin system configuration.",
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true,
              "description": "Enable plugin discovery and loading."
            },
            "directories": {
              "type": "array",
              "items": { "type": "string" },
              "default": ["~/.cleo/plugins", "./.claude/plugins"],
              "description": "Directories to scan for plugins (in order of priority)."
            },
            "autoDiscover": {
              "type": "boolean",
              "default": true,
              "description": "Auto-discover plugins from directories."
            }
          }
        },
        "debug": {
          "type": "object",
          "description": "Debug and validation settings for CLI.",
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false,
              "description": "Enable debug mode (verbose output, validation checks)."
            },
            "validateMappings": {
              "type": "boolean",
              "default": true,
              "description": "Validate command-to-script mappings exist."
            },
            "checksumVerify": {
              "type": "boolean",
              "default": true,
              "description": "Verify script checksums for integrity."
            },
            "showTimings": {
              "type": "boolean",
              "default": false,
              "description": "Show command execution timings."
            }
          }
        }
      }
    },

    "backup": {
      "type": "object",
      "description": "Backup system configuration for snapshots, safety backups, incremental backups, and archive backups.",
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable backup system globally."
        },
        "directory": {
          "type": "string",
          "default": ".claude/backups",
          "description": "Directory for storing all backup types (snapshot, safety, incremental, archive, migration)."
        },
        "maxSnapshots": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "default": 10,
          "description": "Maximum number of snapshot backups to retain (count-based retention)."
        },
        "maxSafetyBackups": {
          "type": "integer",
          "minimum": 0,
          "maximum": 50,
          "default": 5,
          "description": "Maximum number of safety backups to retain (count-based retention, works with safetyRetentionDays)."
        },
        "maxIncremental": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "default": 10,
          "description": "Maximum number of incremental backups to retain (count-based retention)."
        },
        "maxArchiveBackups": {
          "type": "integer",
          "minimum": 0,
          "maximum": 20,
          "default": 3,
          "description": "Maximum number of archive backups to retain (count-based retention)."
        },
        "safetyRetentionDays": {
          "type": "integer",
          "minimum": 0,
          "maximum": 365,
          "default": 7,
          "description": "Days to retain safety backups (time-based retention, works with maxSafetyBackups)."
        },
        "scheduled": {
          "type": "object",
          "description": "Scheduled/automatic backup settings for session events and operations.",
          "additionalProperties": false,
          "properties": {
            "onSessionStart": {
              "type": "boolean",
              "default": false,
              "description": "Create snapshot backup when session starts."
            },
            "onSessionEnd": {
              "type": "boolean",
              "default": false,
              "description": "Create safety backup when session ends."
            },
            "onArchive": {
              "type": "boolean",
              "default": true,
              "description": "Create safety backup before archive operations."
            },
            "intervalMinutes": {
              "type": "integer",
              "minimum": 0,
              "maximum": 1440,
              "default": 0,
              "description": "Optional interval (minutes) for timed backups. 0 disables interval-based backups. When set, backups are created on CLI invocation if interval has elapsed since last backup."
            }
          }
        }
      }
    },

    "cancellation": {
      "type": "object",
      "description": "Configuration for task cancellation/deletion behavior. Safety-first defaults for automation.",
      "additionalProperties": false,
      "properties": {
        "cascadeConfirmThreshold": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "default": 10,
          "description": "Prompt for confirmation when cascade operation affects more than N tasks. Covers typical epic sizes."
        },
        "requireReason": {
          "type": "boolean",
          "default": true,
          "description": "Require --reason flag when cancelling tasks. Enforces accountability and audit trails."
        },
        "daysUntilArchive": {
          "type": "integer",
          "minimum": 0,
          "maximum": 365,
          "default": 3,
          "description": "Days before cancelled tasks are automatically archived. 0 disables auto-archive."
        },
        "allowCascade": {
          "type": "boolean",
          "default": true,
          "description": "Allow --children=cascade mode for parent tasks. When false, only block/orphan/fail modes permitted."
        },
        "defaultChildStrategy": {
          "type": "string",
          "enum": ["block", "orphan", "cascade", "fail"],
          "default": "block",
          "description": "Default behavior for --children flag. block=prevent if has children, orphan=detach children, cascade=cancel children, fail=error."
        }
      }
    },

    "hierarchy": {
      "type": "object",
      "description": "Hierarchy constraints for Epic → Task → Subtask structure. LLM-Agent-First design: limits are organizational, not cognitive.",
      "additionalProperties": false,
      "properties": {
        "maxSiblings": {
          "type": "integer",
          "minimum": 0,
          "maximum": 1000,
          "default": 0,
          "description": "Maximum children per parent (0 = unlimited, recommended for LLM agents). Done tasks excluded by default. See TASK-HIERARCHY-SPEC.md Part 3.2."
        },
        "maxDepth": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10,
          "default": 3,
          "description": "Maximum hierarchy depth (epic=0, task=1, subtask=2). Rarely needs changing."
        },
        "countDoneInLimit": {
          "type": "boolean",
          "default": false,
          "description": "Whether done tasks count toward maxSiblings. Default false: done tasks are historical record, not active context."
        },
        "maxActiveSiblings": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "default": 8,
          "description": "Maximum active (non-done) children per parent. Aligns with TodoWrite sync limit for context management."
        },
        "autoCompleteParent": {
          "type": "boolean",
          "default": false,
          "description": "Automatically complete parent tasks when all children are done."
        },
        "autoCompleteMode": {
          "type": "string",
          "enum": ["auto", "suggest", "off"],
          "default": "off",
          "description": "Auto-complete behavior: auto=silent completion, suggest=prompt user, off=disabled."
        }
      }
    },

    "analyze": {
      "type": "object",
      "description": "Configuration for the analyze command and task prioritization algorithms.",
      "additionalProperties": false,
      "properties": {
        "phaseBoost": {
          "type": "object",
          "description": "Phase alignment boost multipliers for task prioritization. Tasks in the current project phase get higher priority.",
          "additionalProperties": false,
          "properties": {
            "current": {
              "type": "number",
              "default": 1.5,
              "minimum": 1.0,
              "maximum": 3.0,
              "description": "Boost multiplier for tasks in current project phase."
            },
            "adjacent": {
              "type": "number",
              "default": 1.25,
              "minimum": 1.0,
              "maximum": 2.0,
              "description": "Boost multiplier for tasks in adjacent phases (order +/- 1)."
            },
            "distant": {
              "type": "number",
              "default": 1.0,
              "minimum": 1.0,
              "maximum": 1.5,
              "description": "Boost multiplier for tasks in distant phases (order diff > 1)."
            }
          }
        },
        "sizeStrategy": {
          "type": "string",
          "enum": ["quick-wins", "big-impact", "balanced"],
          "default": "balanced",
          "description": "Strategy for weighting tasks by size. quick-wins=favor small tasks, big-impact=favor large tasks, balanced=neutral."
        },
        "sizeWeights": {
          "type": "object",
          "description": "Custom weight multipliers by task size. Used when sizeStrategy is set to custom behavior or for fine-tuning.",
          "additionalProperties": false,
          "properties": {
            "small": {
              "type": "number",
              "default": 1.0,
              "minimum": 0.1,
              "maximum": 3.0,
              "description": "Weight multiplier for small tasks."
            },
            "medium": {
              "type": "number",
              "default": 1.0,
              "minimum": 0.1,
              "maximum": 3.0,
              "description": "Weight multiplier for medium tasks."
            },
            "large": {
              "type": "number",
              "default": 1.0,
              "minimum": 0.1,
              "maximum": 3.0,
              "description": "Weight multiplier for large tasks."
            }
          }
        },
        "staleDetection": {
          "type": "object",
          "description": "Stale task detection settings for analyze command.",
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true,
              "description": "Enable stale task detection in analyze output."
            },
            "pendingDays": {
              "type": "integer",
              "minimum": 1,
              "maximum": 365,
              "default": 30,
              "description": "Days before pending task is considered stale."
            },
            "noUpdateDays": {
              "type": "integer",
              "minimum": 1,
              "maximum": 365,
              "default": 14,
              "description": "Days without notes/updates before task is stale."
            },
            "blockedDays": {
              "type": "integer",
              "minimum": 1,
              "maximum": 365,
              "default": 7,
              "description": "Days blocked without progress before stale warning."
            },
            "urgentNeglectedDays": {
              "type": "integer",
              "minimum": 1,
              "maximum": 30,
              "default": 7,
              "description": "Days high/critical priority task untouched before warning."
            }
          }
        },
        "lockAwareness": {
          "type": "object",
          "description": "Lock file detection and concurrent operation awareness settings.",
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true,
              "description": "Enable lock detection in analyze output."
            },
            "staleThreshold": {
              "type": "integer",
              "minimum": 60,
              "maximum": 3600,
              "default": 300,
              "description": "Seconds before a lock file is considered stale (default: 5 minutes)."
            },
            "warnOnly": {
              "type": "boolean",
              "default": true,
              "description": "Warn about locks but don't block operations. Set false to block on active locks."
            }
          }
        }
      }
    },

    "multiSession": {
      "type": "object",
      "description": "Multi-session concurrent agent configuration. Enables multiple LLM agents to work on different task groups simultaneously with isolated focus and scope boundaries.",
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable multi-session mode. When false, classic single-session behavior. When true, sessions.json is created and used."
        },
        "maxConcurrentSessions": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10,
          "default": 5,
          "description": "Maximum active sessions allowed simultaneously."
        },
        "maxActiveTasksPerScope": {
          "type": "integer",
          "minimum": 1,
          "maximum": 3,
          "default": 1,
          "description": "Maximum active tasks within a single session scope. Replaces global validation.maxActiveTasks."
        },
        "scopeValidation": {
          "type": "string",
          "enum": ["strict", "warn", "none"],
          "default": "strict",
          "description": "strict=error on scope overlap, warn=allow with warning, none=no validation."
        },
        "allowNestedScopes": {
          "type": "boolean",
          "default": true,
          "description": "Allow session scopes that are subsets of other session scopes (e.g., taskGroup within epic)."
        },
        "allowScopeOverlap": {
          "type": "boolean",
          "default": false,
          "description": "Allow sessions with partially overlapping scopes. Risky but sometimes needed for collaborative work."
        },
        "requireScopeOnStart": {
          "type": "boolean",
          "default": true,
          "description": "Require explicit scope when starting session. If false, defaults to full-project scope."
        },
        "sessionTimeoutHours": {
          "type": "integer",
          "minimum": 1,
          "maximum": 168,
          "default": 24,
          "description": "Hours before a session is considered orphaned/stale."
        },
        "autoSuspendOnTimeout": {
          "type": "boolean",
          "default": true,
          "description": "Automatically suspend sessions that exceed timeout instead of ending them."
        },
        "historyRetentionDays": {
          "type": "integer",
          "minimum": 1,
          "maximum": 365,
          "default": 30,
          "description": "Days to retain ended sessions in sessionHistory before cleanup."
        },
        "autoResumeLastSession": {
          "type": "boolean",
          "default": false,
          "description": "When starting without explicit session, auto-resume most recent suspended session for the scope."
        },
        "trackSessionStats": {
          "type": "boolean",
          "default": true,
          "description": "Track session statistics (tasks completed, focus changes, active time)."
        },
        "backupOnSessionEvents": {
          "type": "boolean",
          "default": true,
          "description": "Create safety backup on session start/end/suspend events."
        }
      }
    },

    "contextAlerts": {
      "type": "object",
      "description": "Context window alert configuration. Controls when and how users are alerted about context window usage approaching thresholds.",
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable context window threshold alerts. When false, no alerts are shown."
        },
        "minThreshold": {
          "type": "string",
          "enum": ["warning", "caution", "critical", "emergency"],
          "default": "warning",
          "description": "Minimum threshold level to trigger alerts. warning=70%, caution=85%, critical=90%, emergency=95%."
        },
        "triggerCommands": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": ["complete", "focus", "add", "session"],
          "description": "Commands that trigger context alert checks. Empty array = all commands."
        },
        "suppressDuration": {
          "type": "integer",
          "minimum": 0,
          "maximum": 3600,
          "default": 0,
          "description": "Seconds to suppress repeat alerts at same threshold level. 0 = show on every threshold crossing."
        }
      }
    },

    "research": {
      "type": "object",
      "description": "Subagent research output configuration. Controls where research outputs are stored and how they are managed.",
      "additionalProperties": false,
      "properties": {
        "outputDir": {
          "type": "string",
          "default": "claudedocs/research-outputs",
          "description": "Directory for subagent research outputs relative to project root."
        },
        "manifestFile": {
          "type": "string",
          "default": "MANIFEST.jsonl",
          "description": "Manifest filename (JSONL format) within outputDir."
        },
        "archiveDir": {
          "type": "string",
          "default": "archive",
          "description": "Subdirectory within outputDir for archived research."
        },
        "archiveDays": {
          "type": "integer",
          "default": 30,
          "minimum": 1,
          "description": "Days until non-actionable research is archived."
        },
        "manifest": {
          "type": "object",
          "description": "Manifest rotation and archival configuration.",
          "additionalProperties": false,
          "properties": {
            "maxEntries": {
              "type": "integer",
              "default": 100,
              "minimum": 10,
              "maximum": 1000,
              "description": "Maximum number of entries to keep in active manifest before rotation."
            },
            "thresholdBytes": {
              "type": "integer",
              "default": 200000,
              "minimum": 10000,
              "description": "Size threshold in bytes (~50K tokens at 200KB) before suggesting archival."
            },
            "archivePercent": {
              "type": "integer",
              "default": 50,
              "minimum": 10,
              "maximum": 90,
              "description": "Percentage of oldest entries to archive when threshold is exceeded."
            },
            "autoRotate": {
              "type": "boolean",
              "default": false,
              "description": "Automatically rotate manifest when threshold is exceeded during operations."
            }
          }
        }
      }
    },

    "project": {
      "type": "object",
      "description": "Project-level metadata and status tracking for doctor command and health monitoring.",
      "additionalProperties": false,
      "properties": {
        "status": {
          "type": "object",
          "description": "Current project health status and diagnostic information.",
          "additionalProperties": false,
          "properties": {
            "health": {
              "type": "string",
              "enum": ["healthy", "warning", "error", "unknown"],
              "default": "unknown",
              "description": "Overall project health: healthy=no issues, warning=minor issues, error=critical issues, unknown=not yet checked."
            },
            "lastCheck": {
              "type": ["string", "null"],
              "format": "date-time",
              "default": null,
              "description": "ISO 8601 timestamp of last health check (doctor command). Null if never checked."
            },
            "schemaVersions": {
              "type": "object",
              "description": "Schema versions for core CLEO data files in this project.",
              "additionalProperties": false,
              "properties": {
                "todo": {
                  "type": "string",
                  "pattern": "^\\d+\\.\\d+\\.\\d+$",
                  "description": "Schema version for todo.json (semver)."
                },
                "config": {
                  "type": "string",
                  "pattern": "^\\d+\\.\\d+\\.\\d+$",
                  "description": "Schema version for config.json (semver)."
                },
                "archive": {
                  "type": "string",
                  "pattern": "^\\d+\\.\\d+\\.\\d+$",
                  "description": "Schema version for todo-archive.json (semver)."
                },
                "log": {
                  "type": "string",
                  "pattern": "^\\d+\\.\\d+\\.\\d+$",
                  "description": "Schema version for todo-log.json (semver)."
                }
              }
            },
            "validation": {
              "type": "object",
              "description": "Validation status and results.",
              "additionalProperties": false,
              "properties": {
                "lastValidated": {
                  "type": ["string", "null"],
                  "format": "date-time",
                  "default": null,
                  "description": "ISO 8601 timestamp of last validation run."
                },
                "passed": {
                  "type": "boolean",
                  "default": false,
                  "description": "Whether last validation passed."
                },
                "errors": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "required": ["code", "message"],
                    "additionalProperties": false,
                    "properties": {
                      "code": {
                        "type": "string",
                        "description": "Machine-readable error code."
                      },
                      "message": {
                        "type": "string",
                        "description": "Human-readable error description."
                      },
                      "file": {
                        "type": "string",
                        "description": "File path related to the error."
                      }
                    }
                  },
                  "default": [],
                  "description": "Validation errors from last check."
                },
                "warnings": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "required": ["code", "message"],
                    "additionalProperties": false,
                    "properties": {
                      "code": {
                        "type": "string",
                        "description": "Machine-readable warning code."
                      },
                      "message": {
                        "type": "string",
                        "description": "Human-readable warning description."
                      },
                      "file": {
                        "type": "string",
                        "description": "File path related to the warning."
                      }
                    }
                  },
                  "default": [],
                  "description": "Validation warnings from last check."
                }
              }
            },
            "injection": {
              "type": "object",
              "description": "Agent documentation injection status.",
              "additionalProperties": false,
              "properties": {
                "CLAUDE.md": {
                  "type": "string",
                  "enum": ["injected", "missing", "outdated", "not_found"],
                  "description": "Injection status for CLAUDE.md."
                },
                "AGENTS.md": {
                  "type": "string",
                  "enum": ["injected", "missing", "outdated", "not_found"],
                  "description": "Injection status for AGENTS.md."
                },
                "GEMINI.md": {
                  "type": "string",
                  "enum": ["injected", "missing", "outdated", "not_found"],
                  "description": "Injection status for GEMINI.md."
                }
              }
            }
          }
        }
      }
    },

    "retention": {
      "type": "object",
      "description": "Retention policies for session archival and cleanup. Controls automatic session lifecycle management.",
      "additionalProperties": false,
      "properties": {
        "maxArchivedSessions": {
          "type": "integer",
          "minimum": 10,
          "maximum": 1000,
          "default": 100,
          "description": "Maximum number of archived sessions to retain. Oldest archived sessions are permanently deleted when limit is exceeded."
        },
        "autoArchiveEndedAfterDays": {
          "type": "integer",
          "minimum": 1,
          "maximum": 365,
          "default": 30,
          "description": "Days after which ended sessions are automatically archived. Set to high value to disable auto-archiving."
        },
        "autoDeleteArchivedAfterDays": {
          "type": "integer",
          "minimum": 0,
          "maximum": 730,
          "default": 90,
          "description": "Days after archival before sessions are permanently deleted. 0 disables automatic deletion."
        },
        "contextStateRetentionDays": {
          "type": "integer",
          "minimum": 1,
          "maximum": 90,
          "default": 7,
          "description": "Days to retain orphaned context state files. Files for non-existent or archived sessions are cleaned up."
        },
        "cleanupOnSessionEnd": {
          "type": "boolean",
          "default": true,
          "description": "Run retention cleanup automatically when sessions end. Set false for manual cleanup only."
        },
        "dryRunByDefault": {
          "type": "boolean",
          "default": true,
          "description": "Default to dry-run mode for cleanup operations. Prevents accidental data loss."
        }
      }
    },

    "contextStates": {
      "type": "object",
      "description": "Context state file management configuration. Context state files track per-session context window usage.",
      "additionalProperties": false,
      "properties": {
        "directory": {
          "type": "string",
          "default": ".cleo/context-states",
          "description": "Directory for per-session context state files. Relative to project root."
        },
        "filenamePattern": {
          "type": "string",
          "default": "context-state-{sessionId}.json",
          "description": "Filename pattern for context state files. {sessionId} is replaced with session ID."
        },
        "cleanupOnSessionEnd": {
          "type": "boolean",
          "default": true,
          "description": "Remove context state file when session ends. Set false to retain for debugging."
        },
        "cleanupOnSessionClose": {
          "type": "boolean",
          "default": true,
          "description": "Remove context state file when session is permanently closed."
        },
        "cleanupOnSessionArchive": {
          "type": "boolean",
          "default": true,
          "description": "Remove context state file when session is archived."
        },
        "maxOrphanedFiles": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "default": 10,
          "description": "Maximum orphaned context state files to retain. Oldest are deleted first. 0 = delete immediately."
        }
      }
    },

    "enforcement": {
      "type": "object",
      "description": "Enforcement configuration for task metadata fields. Controls validation and warning behavior for size, acceptance criteria, and auto-extraction features.",
      "additionalProperties": false,
      "properties": {
        "size": {
          "type": "object",
          "description": "Size field enforcement settings.",
          "additionalProperties": false,
          "properties": {
            "requireOnCreate": {
              "type": "boolean",
              "default": false,
              "description": "Require size field on task creation. When true, tasks cannot be created without specifying size."
            },
            "warnMissing": {
              "type": "boolean",
              "default": true,
              "description": "Warn when size is not specified during task creation."
            },
            "defaultValue": {
              "type": ["string", "null"],
              "enum": ["small", "medium", "large", null],
              "default": null,
              "description": "Default size value when not specified. Null means no default (field remains unset)."
            }
          }
        },
        "acceptance": {
          "type": "object",
          "description": "Acceptance criteria enforcement settings.",
          "additionalProperties": false,
          "properties": {
            "mode": {
              "type": "string",
              "enum": ["off", "warn", "block"],
              "default": "warn",
              "description": "Enforcement mode: off=no enforcement, warn=warn when missing, block=require on creation."
            },
            "requiredForPriorities": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["critical", "high", "medium", "low"]
              },
              "default": ["critical", "high"],
              "description": "Priority levels that require acceptance criteria when mode is 'warn' or 'block'."
            }
          }
        },
        "files": {
          "type": "object",
          "description": "File path extraction settings.",
          "additionalProperties": false,
          "properties": {
            "autoExtract": {
              "type": "boolean",
              "default": true,
              "description": "Automatically extract file paths from task notes and add to files array."
            },
            "patterns": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": ["*.ts", "*.js", "*.sh", "*.json", "*.md"],
              "description": "File patterns to recognize during extraction. Uses glob-style patterns."
            }
          }
        },
        "relates": {
          "type": "object",
          "description": "Task cross-reference extraction settings.",
          "additionalProperties": false,
          "properties": {
            "autoExtract": {
              "type": "boolean",
              "default": true,
              "description": "Automatically extract task cross-references (T####) from notes and add to relates array."
            },
            "bidirectional": {
              "type": "boolean",
              "default": false,
              "description": "When adding a reference, also add reverse reference to the target task."
            }
          }
        },
        "verification": {
          "type": "object",
          "description": "Verification gate auto-set settings.",
          "additionalProperties": false,
          "properties": {
            "autoSetImplemented": {
              "type": "boolean",
              "default": true,
              "description": "Automatically set verification.gates.implemented = true when task is completed."
            }
          }
        }
      }
    }
  }
}
