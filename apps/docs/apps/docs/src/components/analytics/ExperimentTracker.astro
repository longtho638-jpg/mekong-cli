---
interface Props {
  experimentId: string;
}

const { experimentId } = Astro.props;
const variantId = Astro.locals.experiments?.[experimentId];
---

{variantId && (
  <script define:vars={{ experimentId, variantId }}>
    // Log exposure on load
    fetch('/api/track', {
      method: 'POST',
      body: JSON.stringify({
        event: 'exposure',
        experimentId,
        variantId,
        url: window.location.pathname
      })
    }).catch(console.error);

    // Expose helper for click tracking
    window.trackConversion = (ctaName) => {
      fetch('/api/track', {
        method: 'POST',
        body: JSON.stringify({
          event: 'conversion',
          experimentId,
          variantId,
          url: window.location.pathname,
          cta: ctaName
        })
      }).catch(console.error);
    };
  </script>
)}
