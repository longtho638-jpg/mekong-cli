---
import LandingLayout from '../layouts/LandingLayout.astro';
import Hero from '../components/Hero.astro';
import { getLocaleFromUrl, useTranslations, getRelativeLocaleUrl } from '@agencyos/i18n/astro';
import { locales } from '@agencyos/i18n/locales';

const locale = getLocaleFromUrl(Astro.url);
const t = useTranslations(locale);

const title = t('commands_page.title');
const description = t('commands_page.description');

// Get "I want" items for mapping
const iWantItems = (locales[locale] as any).commands_page.i_want.items;
const iWantEntries = [
  { id: 'affiliate', cmd: '/affiliate' },
  { id: 'facebook', cmd: '/marketing/social' },
  { id: 'tiktok', cmd: '/video' },
  { id: 'customers', cmd: '/sales/lead' },
  { id: 'proposal', cmd: '/sales/proposal' },
  { id: 'invoice', cmd: '/finance/invoice' },
  { id: 'bug', cmd: '/fix/fast' },
  { id: 'code', cmd: '/code' },
  { id: 'brainstorm', cmd: '/brainstorm' },
  { id: 'competitor', cmd: '/intel/competitor' },
  { id: 'runway', cmd: '/finance/runway' },
  { id: 'strategy', cmd: '/binh-phap' },
  { id: 'ship', cmd: '/ship' },
  { id: 'review', cmd: '/review/codebase' }
];
---

<LandingLayout title={title} description={description}>
  <Hero
    badge={{
      icon: '‚å®Ô∏è',
      text: t('commands_page.hero.badge')
    }}
    title={t('commands_page.hero.title')}
    description={t('commands_page.hero.description')}
  />

  <section class="search-section py-8">
    <div class="mx-auto max-w-4xl px-4">
      <!-- Search Bar -->
      <div class="search-container">
      <div class="search-box">
        <span class="search-icon">üîç</span>
        <input
          type="text"
          id="command-search"
          placeholder={t('commands_page.search.placeholder')}
          autocomplete="off"
        />
        <span class="search-clear" id="search-clear">‚úï</span>
      </div>
      <div class="search-stats">
        <span id="results-count">125</span> {t('commands_page.search.found')}
      </div>
    </div>

    <!-- Category Filter -->
    <div class="category-filter">
      <button class="filter-btn active" data-category="all">{t('commands_page.categories.all')}</button>
      <button class="filter-btn" data-category="tech">üßë‚Äçüíª {t('commands_page.categories.tech')}</button>
      <button class="filter-btn" data-category="marketing">üì£ {t('commands_page.categories.marketing')}</button>
      <button class="filter-btn" data-category="sales">üíº {t('commands_page.categories.sales')}</button>
      <button class="filter-btn" data-category="finance">üí∞ {t('commands_page.categories.finance')}</button>
      <button class="filter-btn" data-category="strategy">üéØ {t('commands_page.categories.strategy')}</button>
    </div>
  </section>

  <!-- T√¥i mu·ªën Index -->
  <section class="want-index reveal">
    <h2 class="text-2xl font-bold mb-6">{t('commands_page.i_want.title')}</h2>
    <div class="want-table">
      <table>
        <thead>
          <tr>
            <th>{t('commands_page.i_want.header_want')}</th>
            <th>{t('commands_page.i_want.header_command')}</th>
            <th>{t('commands_page.i_want.header_result')}</th>
          </tr>
        </thead>
        <tbody>
          {iWantEntries.map(entry => (
            <tr>
              <td><strong>{iWantItems[entry.id][0]}</strong></td>
              <td><code>{entry.cmd}</code></td>
              <td>{iWantItems[entry.id][1]}</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  </section>

  <!-- Tech Commands -->
  <section class="commands-category reveal">
    <div class="category-header">
      <span class="icon">üßë‚Äçüíª</span>
      <h2>{t('commands_page.tech_header')}</h2>
      <span class="badge">{t('commands_page.engine_badge')}</span>
    </div>

    <div class="command-group">
      <h3>{t('commands_page.groups.code')}</h3>
      <div class="commands-row">
        <code>/code</code><code>/code/auto</code><code>/code/parallel</code><code>/code/no-test</code>
      </div>
    </div>

    <div class="command-group">
      <h3>{t('commands_page.groups.fix')}</h3>
      <div class="commands-row">
        <code>/fix</code><code>/fix/fast</code><code>/fix/hard</code><code>/fix/ui</code><code>/fix/types</code><code>/fix/ci</code><code>/fix/logs</code><code>/fix/test</code><code>/fix/parallel</code>
      </div>
    </div>

    <div class="command-group">
      <h3>{t('commands_page.groups.design')}</h3>
      <div class="commands-row">
        <code>/design</code><code>/design/fast</code><code>/design/good</code><code>/design/3d</code><code>/design/screenshot</code><code>/design/video</code><code>/design/describe</code>
      </div>
    </div>

    <div class="command-group">
      <h3>{t('commands_page.groups.docs')}</h3>
      <div class="commands-row">
        <code>/docs</code><code>/docs/init</code><code>/docs/update</code><code>/docs/summarize</code>
      </div>
    </div>

    <div class="command-group">
      <h3>{t('commands_page.groups.git')}</h3>
      <div class="commands-row">
        <code>/git/cm</code><code>/git/pr</code><code>/git/merge</code><code>/git/cp</code>
      </div>
    </div>

    <div class="command-group">
      <h3>{t('commands_page.groups.plan')}</h3>
      <div class="commands-row">
        <code>/plan</code><code>/plan/fast</code><code>/plan/hard</code><code>/plan/parallel</code><code>/plan/ci</code><code>/plan/cro</code><code>/plan/two</code>
      </div>
    </div>

    <div class="command-group">
      <h3>{t('commands_page.groups.others')}</h3>
      <div class="commands-row">
        <code>/test</code><code>/debug</code><code>/scout</code><code>/scout/ext</code><code>/bootstrap</code><code>/cook</code><code>/ask</code><code>/brainstorm</code><code>/journal</code><code>/help</code><code>/status</code><code>/review/codebase</code>
      </div>
    </div>
  </section>

  <!-- Business Commands -->
  <section class="commands-category business">
    <div class="category-header">
      <span class="icon">üíº</span>
      <h2>{t('commands_page.business_header')}</h2>
      <span class="badge new">{t('commands_page.new_badge')}</span>
    </div>

    <div class="command-group">
      <h3>{t('commands_page.groups.marketing')}</h3>
      <div class="commands-row">
        <code>/marketing</code><code>/marketing/social</code><code>/marketing/email</code><code>/marketing/ads</code>
      </div>
    </div>

    <div class="command-group">
      <h3>{t('commands_page.groups.sales')}</h3>
      <div class="commands-row">
        <code>/sales</code><code>/sales/lead</code><code>/sales/proposal</code><code>/sales/close</code>
      </div>
    </div>

    <div class="command-group">
      <h3>{t('commands_page.groups.finance')}</h3>
      <div class="commands-row">
        <code>/finance</code><code>/finance/invoice</code><code>/finance/expense</code><code>/finance/runway</code>
      </div>
    </div>

    <div class="command-group">
      <h3>{t('commands_page.groups.operations')}</h3>
      <div class="commands-row">
        <code>/ops</code><code>/ops/billing</code><code>/ops/reporting</code>
      </div>
    </div>

    <div class="command-group">
      <h3>{t('commands_page.groups.affiliate')}</h3>
      <div class="commands-row">
        <code>/affiliate</code><code>/affiliate/scout</code><code>/affiliate/compare</code><code>/affiliate/signup</code>
      </div>
    </div>

    <div class="command-group">
      <h3>{t('commands_page.groups.video')}</h3>
      <div class="commands-row">
        <code>/video</code><code>/video/script</code><code>/video/voiceover</code><code>/video/edit</code><code>/video/publish</code>
      </div>
    </div>

    <div class="command-group">
      <h3>{t('commands_page.groups.strategy')}</h3>
      <div class="commands-row">
        <code>/binh-phap</code><code>/okr</code><code>/kpi</code><code>/sprint</code><code>/ship</code>
      </div>
    </div>

    <div class="command-group">
      <h3>{t('commands_page.groups.intel')}</h3>
      <div class="commands-row">
        <code>/intel</code><code>/intel/vc</code><code>/intel/competitor</code><code>/fundraise</code>
      </div>
    </div>

    <div class="command-group">
      <h3>{t('commands_page.groups.risk')}</h3>
      <div class="commands-row">
        <code>/equity</code><code>/cap-table</code><code>/moat</code><code>/audit</code><code>/crisis</code><code>/survival</code><code>/pivot</code>
      </div>
    </div>
  </section>

  <section class="cta-section">
    <h2>{t('commands_page.cta.title')}</h2>
    <a href={getRelativeLocaleUrl(locale, '/docs/getting-started/installation')} class="btn-primary">{t('commands_page.cta.button')}</a>
  </section>
</LandingLayout>

<style>
  /* ===================== WANT TABLE WOW ===================== */
  .want-index {
    max-width: 900px;
    margin: 0 auto;
    padding: 24px;
    animation: fade-up 0.6s ease-out 0.3s both;
  }

  .want-index h2 {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--color-text-primary);
    margin-bottom: 16px;
  }

  .want-table {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: 12px;
    overflow: hidden;
  }

  .want-table tr {
    transition: all 0.2s ease;
  }

  .want-table tbody tr:hover {
    background: rgba(34, 197, 94, 0.05);
    transform: translateX(4px);
  }

  .want-table table {
    width: 100%;
    border-collapse: collapse;
  }

  .want-table th,
  .want-table td {
    padding: 12px 16px;
    text-align: left;
    border-bottom: 1px solid var(--color-border);
  }

  .want-table th {
    background: var(--color-bg-tertiary);
    font-weight: 600;
    color: var(--color-text-primary);
    font-size: 0.875rem;
  }

  .want-table td {
    color: var(--color-text-secondary);
    font-size: 0.875rem;
  }

  .want-table code {
    background: var(--color-bg-tertiary);
    color: #22c55e;
    padding: 2px 8px;
    border-radius: 4px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.8rem;
  }

  /* ===================== CATEGORY WOW ===================== */
  .commands-category {
    max-width: 1000px;
    margin: 48px auto;
    padding: 24px;
    animation: section-entrance 0.6s ease-out 0.4s both;
  }

  .commands-category.business {
    animation-delay: 0.6s;
  }

  @keyframes section-entrance {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .category-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 24px;
    flex-wrap: wrap;
  }

  .category-header .icon {
    font-size: 2rem;
    animation: icon-bounce 2s ease-in-out infinite;
  }

  @keyframes icon-bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-4px); }
  }

  .category-header h2 {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--color-text-primary);
    margin: 0;
  }

  .badge {
    background: var(--color-bg-tertiary);
    color: var(--color-text-muted);
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
  }

  .badge.new {
    background: #22c55e;
    color: white;
  }

  .command-group {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 16px;
    transition: all 0.3s ease;
  }

  .command-group:hover {
    border-color: rgba(34, 197, 94, 0.3);
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
  }

  .command-group h3 {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--color-text-muted);
    margin: 0 0 12px 0;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .commands-row {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }

  .commands-row code {
    background: var(--color-bg-tertiary);
    color: #22c55e;
    padding: 6px 12px;
    border-radius: 6px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.8rem;
    transition: all 0.2s ease;
    display: inline-block;
  }

  .commands-row code:hover {
    background: #22c55e;
    color: white;
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 6px 15px rgba(34, 197, 94, 0.3);
  }

  .commands-category.business .commands-row code {
    color: #8b5cf6;
  }

  .commands-category.business .commands-row code:hover {
    background: #8b5cf6;
    color: white;
  }

  /* ===================== CTA WOW ===================== */
  .cta-section {
    text-align: center;
    padding: 64px 24px;
    background: linear-gradient(180deg, transparent, rgba(34, 197, 94, 0.05));
    border-top: 1px solid var(--color-border);
    animation: fade-up 0.6s ease-out 0.8s both;
  }

  .cta-section h2 {
    font-size: 2rem;
    font-weight: 700;
    color: var(--color-text-primary);
    margin-bottom: 24px;
  }

  .btn-primary {
    display: inline-block;
    background: linear-gradient(135deg, #22c55e, #16a34a);
    color: white;
    padding: 14px 32px;
    border-radius: 8px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
    animation: btn-pulse 2.5s ease-in-out infinite;
  }

  @keyframes btn-pulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); }
    50% { box-shadow: 0 0 20px 5px rgba(34, 197, 94, 0.2); }
  }

  .btn-primary:hover {
    transform: translateY(-3px) scale(1.02);
    box-shadow: 0 12px 30px rgba(34, 197, 94, 0.4);
  }

  /* Search Styles */
  .search-container {
    max-width: 500px;
    margin: 24px auto 0;
  }

  .search-box {
    display: flex;
    align-items: center;
    background: var(--color-bg-secondary);
    border: 2px solid var(--color-border);
    border-radius: 12px;
    padding: 12px 16px;
    transition: border-color 0.2s;
  }

  .search-box:focus-within {
    border-color: #22c55e;
  }

  .search-icon {
    margin-right: 12px;
    font-size: 1.2rem;
  }

  .search-box input {
    flex: 1;
    background: none;
    border: none;
    color: var(--color-text-primary);
    font-size: 1rem;
    outline: none;
  }

  .search-box input::placeholder {
    color: var(--color-text-muted);
  }

  .search-clear {
    cursor: pointer;
    color: var(--color-text-muted);
    opacity: 0;
    transition: opacity 0.2s;
  }

  .search-clear.visible {
    opacity: 1;
  }

  .search-stats {
    text-align: center;
    font-size: 0.85rem;
    color: var(--color-text-muted);
    margin-top: 8px;
  }

  .search-stats span {
    color: #22c55e;
    font-weight: 700;
  }

  .category-filter {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-top: 20px;
    flex-wrap: wrap;
  }

  .filter-btn {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    color: var(--color-text-secondary);
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s;
  }

  .filter-btn:hover {
    border-color: #22c55e;
  }

  .filter-btn.active {
    background: #22c55e;
    border-color: #22c55e;
    color: white;
  }

  .command-group.hidden {
    display: none;
  }

  .commands-row code.hidden {
    display: none;
  }

  .no-results {
    text-align: center;
    padding: 48px;
    color: var(--color-text-muted);
  }

  @media (max-width: 768px) {
    .commands-hero h1 {
      font-size: 2rem;
    }

    .want-table {
      overflow-x: auto;
    }
    
    .category-filter {
      gap: 6px;
    }
    
    .filter-btn {
      padding: 6px 12px;
      font-size: 0.75rem;
    }
  }
</style>

<script>
  // Search functionality
  const searchInput = document.getElementById('command-search') as HTMLInputElement;
  const searchClear = document.getElementById('search-clear');
  const resultsCount = document.getElementById('results-count');
  const filterBtns = document.querySelectorAll('.filter-btn');
  const commandCodes = document.querySelectorAll('.commands-row code');
  const commandGroups = document.querySelectorAll('.command-group');
  const wantTable = document.querySelector('.want-index');

  let activeCategory = 'all';

  function filterCommands() {
    const query = searchInput?.value.toLowerCase().trim() || '';
    let count = 0;

    // Show/hide clear button
    if (searchClear) {
      searchClear.classList.toggle('visible', query.length > 0);
    }

    // Hide "want" table when searching
    if (wantTable) {
      (wantTable as HTMLElement).style.display = query ? 'none' : 'block';
    }

    commandCodes.forEach(code => {
      const text = code.textContent?.toLowerCase() || '';
      const group = code.closest('.command-group');
      const category = code.closest('.commands-category');
      
      // Check category
      let categoryMatch = activeCategory === 'all';
      if (category?.classList.contains('business')) {
        // Business commands
        const groupTitle = group?.querySelector('h3')?.textContent?.toLowerCase() || '';
        if (activeCategory === 'marketing' && (groupTitle.includes('marketing') || groupTitle.includes('video'))) categoryMatch = true;
        if (activeCategory === 'sales' && groupTitle.includes('sales')) categoryMatch = true;
        if (activeCategory === 'finance' && (groupTitle.includes('finance') || groupTitle.includes('operations'))) categoryMatch = true;
        if (activeCategory === 'strategy' && (groupTitle.includes('strategy') || groupTitle.includes('intel') || groupTitle.includes('risk'))) categoryMatch = true;
      } else {
        // Tech commands
        if (activeCategory === 'tech') categoryMatch = true;
      }

      // Check search query
      const searchMatch = !query || text.includes(query);

      const visible = categoryMatch && searchMatch;
      (code as HTMLElement).classList.toggle('hidden', !visible);
      
      if (visible) count++;
    });

    // Update count
    if (resultsCount) {
      resultsCount.textContent = count.toString();
    }

    // Hide empty groups
    commandGroups.forEach(group => {
      const visibleCodes = group.querySelectorAll('code:not(.hidden)');
      (group as HTMLElement).classList.toggle('hidden', visibleCodes.length === 0);
    });
  }

  // Event listeners
  searchInput?.addEventListener('input', filterCommands);
  
  searchClear?.addEventListener('click', () => {
    if (searchInput) {
      searchInput.value = '';
      filterCommands();
      searchInput.focus();
    }
  });

  filterBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      filterBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      activeCategory = btn.getAttribute('data-category') || 'all';
      filterCommands();
    });
  });

  // Initial count
  filterCommands();

  // Copy to Clipboard Feature
  const allCodes = document.querySelectorAll('code');
  
  allCodes.forEach(code => {
    // Skip if in pre tag (code blocks)
    if (code.parentElement?.tagName === 'PRE') return;
    
    // Add copyable styling
    code.classList.add('copyable');
    code.title = 'Click to copy';
    
    code.addEventListener('click', async () => {
      const text = code.textContent || '';
      
      try {
        await navigator.clipboard.writeText(text);
        
        // Visual feedback
        code.classList.add('copied');
        
        // Show toast
        showToast(`Copied: ${text}`);
        
        // Reset after animation
        setTimeout(() => {
          code.classList.remove('copied');
        }, 1000);
      } catch (err) {
        console.error('Failed to copy:', err);
      }
    });
  });

  // Toast notification
  function showToast(message: string) {
    // Remove existing toast
    const existing = document.querySelector('.copy-toast');
    if (existing) existing.remove();
    
    // Create toast
    const toast = document.createElement('div');
    toast.className = 'copy-toast';
    toast.innerHTML = `<span class="toast-icon">‚úì</span> ${message}`;
    document.body.appendChild(toast);
    
    // Animate in
    requestAnimationFrame(() => {
      toast.classList.add('visible');
    });
    
    // Remove after 2s
    setTimeout(() => {
      toast.classList.remove('visible');
      setTimeout(() => toast.remove(), 300);
    }, 2000);
  }
</script>

<style>
  /* Copy to Clipboard */
  code.copyable {
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
  }

  code.copyable:hover {
    background: rgba(34, 197, 94, 0.2);
    transform: scale(1.02);
  }

  code.copyable:hover::after {
    content: 'üìã';
    position: absolute;
    right: -20px;
    opacity: 0.7;
    font-size: 0.75rem;
  }

  code.copied {
    background: rgba(34, 197, 94, 0.4) !important;
    animation: copyPulse 0.3s ease;
  }

  @keyframes copyPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
  }

  /* Toast Notification */
  .copy-toast {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: linear-gradient(135deg, #22c55e, #16a34a);
    color: white;
    padding: 12px 24px;
    border-radius: 50px;
    font-size: 0.9rem;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 10px 30px rgba(34, 197, 94, 0.4);
    z-index: 99999;
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .copy-toast.visible {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }

  .toast-icon {
    font-size: 1rem;
  }
</style>
