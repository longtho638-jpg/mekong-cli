---
// src/components/nav/SupportNav.astro
import { getLangFromUrl, getDocPath } from '../../i18n/utils';

interface Props {
  docs: any[];
  currentPath: string;
}

const { docs, currentPath } = Astro.props;
const currentLocale = getLangFromUrl(Astro.url);

// Group by category
const grouped = docs.reduce((acc: Record<string, any[]>, doc: any) => {
  const cat = doc.data.category || 'uncategorized';
  if (!acc[cat]) acc[cat] = [];
  acc[cat].push(doc);
  return acc;
}, {});

// Sort within groups
Object.keys(grouped).forEach(key => {
  grouped[key].sort((a: any, b: any) => (a.data.order || 999) - (b.data.order || 999));
});

// Category metadata
const categories: Record<string, { title: string; collapsible: boolean }> = {
  'troubleshooting': { title: 'Troubleshooting', collapsible: false },
  'uncategorized': { title: 'Support', collapsible: false },
};
---

<div class="support-nav">
  {Object.entries(grouped).map(([category, categoryDocs]) => {
    const meta = categories[category] || { title: category, collapsible: false };

    return (
      <div class="nav-section">
        <div class="nav-section-title">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="folder-icon"
          >
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
          </svg>
          {meta.title}
        </div>

        <ul class="nav-items">
          {categoryDocs.map((doc: any) => {
            const href = getDocPath(doc.slug, currentLocale);
            const isActive = currentPath === href;

            return (
              <li>
                <a
                  href={href}
                  class:list={['nav-link', { active: isActive }]}
                >
                  <span>{doc.data.title}</span>
                </a>
              </li>
            );
          })}
        </ul>
      </div>
    );
  })}
</div>

<style>
  .support-nav {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
  }

  .nav-section {
    display: flex;
    flex-direction: column;
    margin-bottom: var(--space-4);
  }

  .nav-section-title {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-xs);
    font-weight: var(--font-semibold);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-secondary);
    padding: var(--space-2) var(--space-3);
    margin-bottom: var(--space-1);
  }

  .folder-icon {
    color: var(--color-accent-blue);
    width: var(--icon-sm);
    height: var(--icon-sm);
    flex-shrink: 0;
  }

  .nav-items {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 0;
  }

  .nav-link {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-2) var(--space-3);
    padding-left: calc(var(--space-3) + 12px);
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
    border-radius: var(--radius-md);
    transition: all 0.15s;
    text-decoration: none;
  }

  .nav-link:hover {
    background: var(--color-bg-tertiary);
    color: var(--color-text-primary);
    text-decoration: none;
  }

  .nav-link.active {
    background: var(--color-bg-tertiary);
    color: var(--color-accent-blue);
    border-left: 2px solid var(--color-accent-blue);
    padding-left: calc(var(--space-3) + 10px);
    font-weight: var(--font-normal);
  }
</style>